apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: weaviateclusters.weaviate.io
spec:
  group: weaviate.io
  names:
    kind: WeaviateCluster
    listKind: WeaviateClusterList
    plural: weaviateclusters
    shortNames:
    - wvc
    singular: weaviatecluster
  scope: Namespaced
  versions:
  - name: v1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        description: WeaviateCluster is the Schema for the weaviateclusters API
        type: object
        properties:
          apiVersion:
            type: string
          kind:
            type: string
          metadata:
            type: object
          spec:
            description: WeaviateClusterSpec defines the desired state of WeaviateCluster
            type: object
            required:
            - version
            - replicas
            - storage
            properties:
              version:
                type: string
                description: Version specifies the Weaviate version to deploy
              replicas:
                type: integer
                minimum: 1
                default: 1
                description: Replicas is the number of desired pods
              resources:
                type: object
                description: Resources defines the compute resources
                x-kubernetes-preserve-unknown-fields: true
              storage:
                type: object
                required:
                - size
                properties:
                  size:
                    type: string
                  storageClassName:
                    type: string
                  volumeClaimTemplate:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
              autoScaling:
                type: object
                properties:
                  enabled:
                    type: boolean
                  minReplicas:
                    type: integer
                    minimum: 1
                  maxReplicas:
                    type: integer
                    minimum: 1
                  targetCPU:
                    type: integer
                    minimum: 1
                    maximum: 100
                  targetMemory:
                    type: integer
                    minimum: 1
                    maximum: 100
                  targetQPS:
                    type: integer
                  targetLatency:
                    type: string
              modules:
                type: array
                items:
                  type: object
                  required:
                  - name
                  - enabled
                  properties:
                    name:
                      type: string
                    enabled:
                      type: boolean
                    config:
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                    resources:
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
              cloudProvider:
                type: object
                properties:
                  type:
                    type: string
                    enum:
                    - aws
                    - gcp
                    - azure
                  region:
                    type: string
                  aws:
                    type: object
                    properties:
                      ebsOptimized:
                        type: boolean
                      instanceType:
                        type: string
                      useLocalNVMe:
                        type: boolean
                      backup:
                        type: object
                        properties:
                          bucket:
                            type: string
                          region:
                            type: string
                  gcp:
                    type: object
                    properties:
                      useLocalSSD:
                        type: boolean
                      machineType:
                        type: string
                      backup:
                        type: object
                        properties:
                          bucket:
                            type: string
                  azure:
                    type: object
                    properties:
                      vmSize:
                        type: string
                      usePremiumStorage:
                        type: boolean
                      backup:
                        type: object
                        properties:
                          storageAccount:
                            type: string
                          container:
                            type: string
              serviceMesh:
                type: object
                properties:
                  enabled:
                    type: boolean
                  type:
                    type: string
                  mTLS:
                    type: boolean
              image:
                type: object
                properties:
                  repository:
                    type: string
                  tag:
                    type: string
                  pullPolicy:
                    type: string
                    enum:
                    - Always
                    - IfNotPresent
                    - Never
                  pullSecrets:
                    type: array
                    items:
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
              env:
                type: array
                items:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
          status:
            description: WeaviateClusterStatus defines the observed state
            type: object
            properties:
              phase:
                type: string
              replicas:
                type: integer
              readyReplicas:
                type: integer
              conditions:
                type: array
                items:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
              observedGeneration:
                type: integer
    subresources:
      status: {}
    additionalPrinterColumns:
    - name: Version
      type: string
      jsonPath: .spec.version
    - name: Replicas
      type: integer
      jsonPath: .spec.replicas
    - name: Phase
      type: string
      jsonPath: .status.phase
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
